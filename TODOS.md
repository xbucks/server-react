# TODOS

- [x] Create a basic reason project with alcotest
- [x] Take a look at a [Rust implementation](https://github.com/MaibornWolff/react-wasm-dom)
- [x] Try to render a string given a React Tree
- [x] Define the React Tree using React.createElement (not the JSX ppx)
- [x] Allow attributes to be strings or booleans
- [x] Handle ReasonReact APIS. React.null, React.string, React.int
- [x] Handle fragments
- [x] Add data-reactroot="" to the root element
  - [x] Abstract renderToStringRec to handle internal state (ref is_root)
- [x] Handle value/defaultValue logic and similars
- [x] Handle [style attribute](https://github.com/MaibornWolff/react-wasm-dom/blob/main/src/__tests__/CSSPropertyOperations-test.jsx)
- [x] Implement [React.Context](https://github.com/preactjs/preact-render-to-string/blob/master/test/context.test.js)
- [x] Does the order of attributes matter on cloneElement
- [x] React.cloneElement
  - How does it work for Fragments/Texts/Empty?
- [x] [Scape text with HTML](https://github.com/MaibornWolff/react-wasm-dom/blob/main/src/__tests__/escapeTextForBrowser-test.jsx) [entities](https://stackoverflow.com/questions/7381974/which-characters-need-to-be-escaped-in-html)
  - Should we handle every html entity?
- [x] Handle refs
- [x] Handle useContext
- [x] Run useState
- [x] Handle React.memoN
- [x] Handle React.useCallbackN
- [x] Ignore useEffect
- [x] Handle React dengerouslySetInnerHTML
- [x] Add test for hooks
- [x] Implement all JSX logic
  - [x] [ReactDOMServerIntegrationAttributes](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationAttributes-test.js)
  - [x] [ReactDOMServerIntegrationCheckbox](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationCheckbox-test.js)
  - [x] [ReactDOMServerIntegrationElements](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationElements-test.js)
  - [x] [ReactDOMServerIntegrationFragment](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationFragment-test.js)
  - [x] [ReactDOMServerIntegrationHooks](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationHooks-test.js)
  - [x] [ReactDOMServerIntegrationInput](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationInput-test.js)
  - [x] [ReactDOMServerIntegrationLegacyContext](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationLegacyContext-test.js)
  - [x] [ReactDOMServerIntegrationLegacyContextDisabled](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationLegacyContextDisabled-test.internal.js)
  - [x] [ReactDOMServerIntegrationModes](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationModes-test.js)
  - [x] [ReactDOMServerIntegrationNewContext](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationNewContext-test.js)
  - [x] [ReactDOMServerIntegrationReconnecting](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationReconnecting-test.js)
  - [x] [ReactDOMServerIntegrationRefs](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationRefs-test.js)
  - [x] [ReactDOMServerIntegrationSelect](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationSelect-test.js)
  - [x] [ReactDOMServerIntegrationSpecialTypes](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationSpecialTypes-test.js)
  - [x] [ReactDOMServerIntegrationTextarea](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationTextarea-test.js)
  - [x] [ReactDOMServerIntegrationUntrustedURL](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationUntrustedURL-test.internal.js)
  - [x] [ReactDOMServerIntegrationUserInteraction](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerIntegrationUserInteraction-test.js)
  - [x] [ReactDOMServerLifecycles](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerLifecycles-test.js)
  - [x] [ReactDOMServerPartialHydration](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerPartialHydration-test.internal.js)
  - [x] [ReactDOMServerSelectiveHydration](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerSelectiveHydration-test.internal.js)
  - [x] [ReactDOMServerSuspense](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMServerSuspense-test.internal.js)
  - [x] cased custom attributes
  - [x] no HTML events
  - [x] no unknown events
- [x] Events
  - [x] Ignore events on the server
  - [x] Transform to structure for react.ml
  - [ ] What's happening with Drag type
  - [ ] Are we sure that all cases are ignored? onClick callbacks yes, but what about other kinds? "void(0)" or other edgy cases? They aren't supported in Reason JSX afaik.
- [ ] Implement renderToString
  - [ ] Import test cases and implement those
  - [ ] Check what are the differences
- [ ] Implement the rest of the React API
  - [x] Support forwardRef
  - [x] Support Ref
  - [ ] Shim suspense
  - [ ] Shim useImperativeHandle
  - [ ] Shim useLayoutEffect
  - [ ] Shim useTransition
  - [ ] Shim displayName/setDisplayName
  - [ ] Re-visit cloneElement (most of our constructors don't make sense to "clone")
  - [ ] What other React APIs do we need to implement?
  - [ ] createRoot/createBlockingRoot
  - [ ] hydrate
  - [ ] createPortal

- [x] ReactDOM.Style.make
- [ ] Handle unicode. Add Uutfs?
- [x] Add setState callbacks as tick on the dispatcher
  - [x] Open an issue in facebook/react [Done](https://github.com/facebook/react/issues/25318)
  - [x] __Implement dispatcher__
- [ ] Add support for SVGs (they have a few differences in rendering the tag and attributes)
- [x] Rename React.Node.t and others to React.Element
- [ ] Ensure types from TypeScript make sense with our implementation
- [ ] A way to trigger warnings for invalid attributes in special elements
  - [ReactDOMTextarea](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMTextarea-test.js)
  - [ReactDOMSelect](https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMSelect-test.js)

## ppx transformation

- [x] Remove all `jsoo` specific
- [x] Render to something that makes sense
- [x] Transform attributes to JSX
- [x] Transform lower case components
- [x] Transform React.Components
- [x] Add Events
- [x] Enable reason test from ppx
- [x] Transform Fragments to the right type s/React.Fragment.createElement/React.createFragment?
  - [x] Fix fragments and childrens
- [ ] Transform signatures
- [ ] Transform externals
- [x] Allow recursive components
- [x] Is childrenArg ref hack, necessary?
- [ ] Add rescript/lang tests
- [ ] Can we cleanup this beast?
  - [ ] There's a ton of unncessary expressions to early
  - [ ] The flow of the AST passes aren't clear
  - [ ] There's an extra `[@JSX]` attribute that doesn't get deleted?
- [x] Are keys necessary? Can we remove them?
- [ ] How should we handle errors from `createElement` or `renderToString`
- [x] Suspense? "ReactDOMServer does not yet support Suspense - server/node_modules/react-dom/cjs/react-dom-server.node.development.js:3518"
- [x] How does SSR handle component runtime?
  - If there is a function call such as state` inside a component?
  - Lists with keys, why SSR complains?
    - Because there's re-rendering inside SSR. Reconciling? Commiting? What?
- [ ] Do we need CSSOperations?
  - Add the units (adding `px` when matters and other cases from [CSSPropertyOperations-test](https://github.com/MaibornWolff/react-wasm-dom/blob/main/src/__tests__/CSSPropertyOperations-test.jsx))?
- [ ] How difficult would be to support Server components?
- [x] Do we need to support [React.Children API](https://github.com/reasonml/reason-react/blob/master/src/React.re#L58-L76) from reason-react. Almost deprecated.

## Demo/migration

- [x] Pipe first
  - [x] Implement ppx
- [x] Create a server to render HTML with native-react-dom
- [x] Compile the same code to the client
- [x] Split commands to run tests and builds separately
- [x] Allow to build with melange and OCaml
- [ ] Try fetch
- [ ] Try promise
- [ ] Try belt
- [ ] Benchmarks
  - [wrk](https://github.com/wg/wrk)
  - [k6](https://github.com/grafana/k6)
  - [autocannon](https://github.com/mcollina/autocannon)
  - [cassowary](https://github.com/rogerwelin/cassowary)
- [ ] How we are going to mock the [JavaScript APIs](https://rescript-lang.org/docs/manual/latest/api/js) from ReScript?
- [ ] How we are going to mock the DOM API?
  - [x] Create library from bs-webapi
  - [ ] Found a way to add it incrementally?
  - [ ] What can we do with externals?
- [ ] What other ReScript specific stuff need to take care?
  - Do we have any way to ensure `bs.obj` compiles in native?
    - Idea: Treat all Js.t as OCaml objects, transform all a##b to (a#b).
    - [ ] Implement ## ppx
    - `##` is parsed by Reason
    - Probably only in melange?
    - Add ppx processing to replace `bs.obj` with classic OCaml objects (e.g. `{"foo": 2}` translates to `object method foo = 2 end`).
  - [ ] In most cases we should failwith when those appear while we try to think what's the good plan for shimming
  - [ ] Antonio mention `optcomp/conditional compilation could work`
  - [ ] How elliom works? (`[%server]` and `[%client]`)
